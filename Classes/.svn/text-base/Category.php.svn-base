<?php
/**
 * Category.php
 * @author Brian Astrup Mikkelsen
 * @email brian@mikkelsen.com
 * @year 2011
 */

class Category{


    private $data;
    public $categories;
    public $courses;

    public function __construct($cat){
        global $DB;
        
        if( is_object($cat)) { 
            $this->data = $cat;
            $cat = (int) $cat->id; 
            
        }
        
        if( ! is_numeric($cat)){
            throw new InvalidArgumentException('Not an integer:'.$cat);
        
        }

        if( $cat === 0){
            $this->data = new StdClass();
            $this->data->name = "TOP";
            $this->data->id = 0;
        } 

        if( ! $this->data) {
            $this->data = $DB->get_record('course_categories',array('id'=>$cat));
            if ( ! $this->data) {
                throw new UnexpectedValueException('Could not load category id:'.$cat);
            }
        }
        


        $this->categories = array();
        foreach(get_child_categories($cat) as $child){
            $this->categories[] = new Category($child);
        }

        $this->courses = array();

        if($cat == 0) {
            return 0; // no courses allowed on TOP
        }

        require_once(dirname(__FILE__) . '/Course.php');
        
        foreach(get_courses($cat) as $course){
            
            $this->courses[] = new Course($course);
        }
    }

    public function __get($var){
        $getter = sprintf('get_%s',$var);
        if( method_exists($this,$getter)){
            return $this->$getter();
        }
        return $this->data->$var;
    }

    public function __set($var,$value){
        $setter = sprintf('set_%s',$var);
        if( has_method($this,$setter)){
            return $this->$setter($value);
        }
    }

}


